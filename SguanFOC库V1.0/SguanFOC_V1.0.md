# SguanFOC库 v1.0

一套专为带传感器永磁同步电机（PMSM）设计的全面磁场定向控制（FOC）实现方案。本库为初级开发者提供了高级电机控制应用的坚实基础，将数学精确性与实际可用性完美结合。

## 库架构

该库采用模块化架构，将控制算法、硬件抽象和用户配置分离。其核心的FOC系统将三相电机控制转换为可管理的d-q坐标系操作，实现精确的转矩和位置控制。<img width="1058" height="348" alt="image" src="https://github.com/user-attachments/assets/35c96b1b-91c8-4c1e-9759-0e731e34ef33" />


## 核心数据结构

该库围绕两个主要数据结构构建，用于管理所有FOC操作：

### `SVPWM_HandleTypeDef`
管理电压变换和PWM生成，实现从d-q坐标到三相输出的完整信号流 [`SguanFOC.h#L11-L33`]：

- **输入**：d-q电压（`u_d`, `u_q`）、转子角度（`theta`）
- **中间量**：α-β电压、三角函数值
- **输出**：三相PWM占空比（`t_a`, `t_b`, `t_c`）
- **反馈**：三相电流及变换后的d-q电流

### `FOC_HandleTypeDef`
包含不同控制策略的所有PID控制器配置 [`SguanFOC.h#L35-L113`]：

- **单环控制器**：位置、速度、电流
- **级联控制器**：位置-速度、速度-电流、位置-速度-电流
- **每个控制器**：Kp、Ki、Kd增益及积分和误差跟踪

## 多语言支持

该库提供双重实现选项：

| 特性 | C语言 | Python |
|------|-------|--------|
| 性能 | 实时优化 | 快速原型开发 |
| 硬件访问 | 直接寄存器控制 | 高级抽象 |
| 集成 | 嵌入式系统 | 桌面/研究 |
| 内存使用 | 最小 | 较高开销 |

## 控制模式概述

该库支持针对不同应用需求的全面控制策略：

### 🎯 多种控制模式
- **开环控制**：基本操作的位置和速度模式
- **单环闭环控制**：独立的位置、速度或电流控制
- **级联控制**：
  - 位置-速度双环
  - 速度-电流双环
  - 位置-速度-电流三环

### ⚡ 高级FOC实现
- 7段调制空间矢量PWM（SVPWM）
- 实时性能的快速三角函数近似
- 逆Park和Clarke/Park变换
- 自动编码器对齐和偏移校准

## 核心技术特性

| 类别 | 特性 |
|------|------|
| 控制算法 | 可配置PID控制器、级联控制系统 |
| 信号处理 | 卡尔曼滤波、低通滤波器、降噪 |
| 数学优化 | 快速sin/cos近似、多项式优化 |
| 硬件集成 | 编码器校准、电流检测、死区补偿 |
| 安全特性 | 输出限制、角度超前补偿、方向控制 |

该库的模块化设计使你可以从简单的开环控制开始，随着应用需求的发展逐步实现更复杂的级联控制系统。

## 项目结构
